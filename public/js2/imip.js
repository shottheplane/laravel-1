function showSupplierImDialog(a,b){IMIP.supplierSysParam=a,IMIP.supplierImParam=b,IMIP.createScript(IMIP.servicePath+"/getSupplierInfo?callback=showSupplierImDialogCallBack&supplierId="+b.supplier_id)}function showSupplierImDialogCallBack(a){var b=IMIP.supplierSysParam;IMIP.supplierSysParam={},IMIP.supplierImParam.shop_id=a,a=IMIP.supplierImParam,IMIP.supplierImParam={},showImDialog(b,a)}function showImDialog(a,b){var c,d,e;if("undefined"!=typeof IMIP_CONF.isH5Entrance[a.entrance_code]&&null!=IMIP_CONF.isH5Entrance[a.entrance_code]&&(IMIP.currentEntranceCode=a.entrance_code,c=getBtnValidity(b.shop_id),null==c||""==c||c||"true"==c)){if("undefined"!=typeof a.action){if("stats"==a.action)return IMIP.action=a.action,c={group_configs:[]},c.group_configs.push({group_id:IMIP_CONF.xnDefaultSettiongId}),c.is_valid=!0,d=getUserLevel(b.shop_id),c.user_info=""==d||null==d&&"null"!=d?{user_level:0}:{user_level:d},showImDialogCallBack(c,b),void 0;"consult"!=a.action&&(IMIP.action="")}else IMIP.action="consult";e={entrance_code:a.entrance_code,position_code:a.position_code,shop_id:b.shop_id,fields:"group_configs,is_valid,user_info"},"undefined"!=typeof a.group_id&&""!=a.group_id&&(IMIP.currentGroupId=a.group_id,e.fields="is_valid,user_info"),"consult"==IMIP.action?showMsgBox("","","",function(){getMerchantGroupInfo(e,showImDialogCallBack,b)},"id"):getMerchantGroupInfo(e,showImDialogCallBack,b)}}function showImDialogCallBack(a,b){var c,d,e;if(a.is_valid){if("undefined"!=typeof a.group_configs&&null!=a.group_configs&&"undefined"!=typeof a.group_configs[0]&&null!=a.group_configs[0]&&"undefined"!=typeof a.group_configs[0].group_id&&null!=a.group_configs[0].group_id&&(IMIP.currentGroupId=a.group_configs[0].group_id),IMIP.currentSellerId="",IMIP.currentUserlevel=a.user_info.user_level,NTKF_PARAM.settingid=IMIP.currentGroupId,""!=b.shop_id&&"0"!=b.shop_id){if(c=(""+b.shop_id).split(","),d=c.length,d>0)for(e=0;d>e;e++)""!=IMIP.currentSellerId&&(IMIP.currentSellerId+=","),IMIP.currentSellerId+=IMIP.getSellerIdByShopId(c[e]);("undefined"==typeof a.purpose||"consult"==a.purpose)&&(NTKF_PARAM.sellerid=IMIP.currentSellerId)}if(NTKF_PARAM.userlevel=null==IMIP.currentUserlevel||""==IMIP.currentUserlevel||"null"==IMIP.currentUserlevel?0:IMIP.currentUserlevel,"undefined"!=typeof b.order_price&&""!=b.order_price&&(NTKF_PARAM.orderprice=b.order_price),"undefined"!=typeof b.order_id&&""!=b.order_id&&(NTKF_PARAM.orderid=b.order_id),NTKF_PARAM.ntalkerparam={},"undefined"!=typeof b.product&&null!=b.product)NTKF_PARAM.ntalkerparam.item={},NTKF_PARAM.ntalkerparam.item.id=b.product.product_id,NTKF_PARAM.ntalkerparam.item.name=b.product.product_name,NTKF_PARAM.ntalkerparam.item.imageurl="undefined"!=typeof b.product.image_url&&""!=b.product.image_url?b.product.image_url:IMIP.getImageUrl(b.product.product_id),NTKF_PARAM.ntalkerparam.item.url="undefined"!=typeof b.product.product_url&&""!=b.product.product_url?b.product.product_url:IMIP.isFromH5(a.entrance_code)?IMIP.getH5ProductUrl(b.product.product_id):IMIP.getPcProductUrl(b.product.product_id),NTKF_PARAM.ntalkerparam.item.marketprice=b.product.original_price,NTKF_PARAM.ntalkerparam.item.siteprice=b.product.sale_price,"undefined"!=typeof b.product.custom_XXX&&null!=b.product.custom_XXX&&(NTKF_PARAM.ntalkerparam.item.customXXX=b.product.custom_XXX),"undefined"!=typeof b.product.custom_price&&null!=b.product.custom_price&&(NTKF_PARAM.ntalkerparam.item.customprice=b.product.custom_price);else if("undefined"!=typeof b.products&&null!=b.products&&(NTKF_PARAM.ntalkerparam.items=eval("[]"),d=b.products.length,d>0))for(e=0;d>e;e++)itemObj={},itemObj.id=b.products[e].product_id,""!=IMIP.currentSellerId&&"0"!=IMIP.currentSellerId&&(itemObj.sellerid=IMIP.currentSellerId),itemObj.name=b.products[e].product_name,itemObj.count=b.products[e].count,itemObj.imageurl="undefined"!=typeof b.products[e].image_url&&""!=b.products[e].image_url?b.products[e].image_url:IMIP.getImageUrl(b.products[e].product_id),itemObj.url="undefined"!=typeof b.products[e].product_url&&""!=b.products[e].product_url?b.products[e].product_url:IMIP.isFromH5(a.entrance_code)?IMIP.getH5ProductUrl(b.products[e].product_id):IMIP.getPcProductUrl(b.products[e].product_id),itemObj.siteprice=b.products[e].site_price,NTKF_PARAM.ntalkerparam.items.push(itemObj);IMIP.isFromH5(a.entrance_code)?IMIP.showImDialogForH5():IMIP.showImDialogForPc()}}function getSupplierGroupInfo(a,b,c){IMIP.supplierParam=a,IMIP.supplierCallBackFunc=b,IMIP.supplierCallBackPrameters=c,IMIP.createScript(IMIP.servicePath+"/getSupplierInfo?callback=getSupplierGroupInfoCallBack&supplierId="+a.supplier_id)}function getSupplierGroupInfoCallBack(a){var b,c,d;IMIP.supplierParam.shop_id=a,b=IMIP.supplierParam,IMIP.supplierParam={},c=IMIP.supplierCallBackFunc,IMIP.supplierCallBackFunc={},d=IMIP.supplierCallBackPrameters,IMIP.supplierCallBackPrameters={},"null"!=a?getMerchantGroupInfo(b,c,d):c({},d)}function getMerchantGroupInfo(a,b,c){if("undefined"!=typeof IMIP_CONF.isH5Entrance[a.entrance_code]&&null!=IMIP_CONF.isH5Entrance[a.entrance_code]&&"undefined"!=typeof b&&null!=b){for(var d=a.fields.split(","),e=0;e<d.length;e++)if("is_valid"!=d[e]&&"group_configs"!=d[e]&&"service_times"!=d[e]&&"user_info"!=d[e])return null;IMIP.currentEntranceCode=a.entrance_code,"showImDialogCallBack"==b.name?(IMIP.innerCallBackFuncs=b,IMIP.innerCallBackPrameters=c):(IMIP.callBackFuncs[a.shop_id]=b,("undefined"==typeof IMIP.callBackPrameters[a.shop_id]||null==IMIP.callBackPrameters[a.shop_id])&&(IMIP.callBackPrameters[a.shop_id]=[]),IMIP.callBackPrameters[a.shop_id].push(c)),buildParamForGetMerchantGroupInfo(a,b)}}function getMerchantGroupInfoCallBack(a){var c,d,e,b={};if(b.entrance_code=IMIP.currentEntranceCode,b.shop_id=a.resultObject.shopId,"undefined"!=typeof a.resultObject.validity&&null!=a.resultObject.validity&&("undefined"!=typeof a.resultObject.userInfo&&null!=a.resultObject.userInfo&&"undefined"!=typeof a.resultObject.userInfo.userId&&null!=a.resultObject.userInfo.userId&&setBtnValidity(a.resultObject.shopId,a.resultObject.validity.isValid,a.resultObject.validity.expires),b.is_valid=a.resultObject.validity.isValid),"undefined"!=typeof a.resultObject.userInfo&&null!=a.resultObject.userInfo&&(b.user_info={},b.user_info.user_id=a.resultObject.userInfo.userId,b.user_info.user_level=a.resultObject.userInfo.userLevel,NTKF_PARAM.userlevel=null!=b.user_info.user_level&&""!=b.user_info.user_level?b.user_info.user_level:0,setUserLevel(a.resultObject.shopId,b.user_info.user_level,3600)),"undefined"!=typeof a.resultObject.customerGroupConfigList&&null!=a.resultObject.customerGroupConfigList&&(c=a.resultObject.customerGroupConfigList,0<c.length))for(b.group_configs=eval("[]"),d=0;d<c.length;d++)e={},e.shop_group_name=c[d].customerGroupName,e.group_id=c[d].groupId,e.position_code=c[d].positionCode,e.sort_num=c[d].sortNo,b.group_configs.push(e);if("undefined"!=typeof a.resultObject.serviceTimeList&&null!=a.resultObject.serviceTimeList&&(c=a.resultObject.serviceTimeList,0<c.length))for(b.service_times=eval("[]"),d=0;d<c.length;d++)e={},e.begin_day=c[d].beginWeekDay,e.end_day=c[d].endWeekDay,e.begin_time=c[d].beginTime,e.end_time=c[d].endTime,b.service_times.push(e);"undefined"!=typeof IMIP_CONF.isLoadInAdvance[b.entrance_code]&&IMIP_CONF.isLoadInAdvance[b.entrance_code]&&("undefined"!=typeof a.resultObject.purpose&&"consult"==a.resultObject.purpose||0==b.shop_id||!IMIP_CONF.setSellerId[b.entrance_code]||(NTKF_PARAM.sellerid=IMIP.getSellerIdByShopId(b.shop_id)),"undefined"!=typeof NTKF&&null!=NTKF||IMIP.isXnJsLoaded||(jQuery.ajax({url:IMIP_CONF.xnJsPath,dataType:"script",cache:!0}),IMIP.isXnJsLoaded=!0)),"undefined"!=typeof a.resultObject.purpose&&"consult"==a.resultObject.purpose?b.is_valid&&(d=IMIP.innerCallBackFuncs,c=IMIP.innerCallBackPrameters,b.purpose=a.resultObject.purpose,d(b,c)):(d=IMIP.callBackFuncs[a.resultObject.shopId],c=IMIP.callBackPrameters[a.resultObject.shopId].shift(),d(b,c))}function buildParamForGetMerchantGroupInfo(a,b){var c,d,e,f,g;if(NTKF_PARAM.uid=IMIP.isFromH5(a.entrance_code)?IMIP.getCookie2("MDD_email",!0):IMIP.getCookie("ddoy","email",!0),NTKF_PARAM.uname=NTKF_PARAM.uid,"is_valid"==a.fields){if(c=getUserLevel(a.shop_id),""!=c&&null!=c&&"null"!=c&&(NTKF_PARAM.userlevel=c,"undefined"==typeof IMIP_CONF.isLoadInAdvance[a.entrance_code]||!IMIP_CONF.isLoadInAdvance[a.entrance_code]||"undefined"!=typeof NTKF&&null!=NTKF||IMIP.isXnJsLoaded||(jQuery.ajax({url:IMIP_CONF.xnJsPath,dataType:"script",cache:!0}),IMIP.isXnJsLoaded=!0),c=getBtnValidity(a.shop_id),null!=c&&""!=c))return c={entrance_code:a.entrance_code,shop_id:a.shop_id,is_valid:"true"==c?!0:!1},d=IMIP.callBackFuncs[a.shop_id],e=IMIP.callBackPrameters[a.shop_id].shift(),d(c,e),void 0;a.fields="is_valid,user_info"}for(d=a.fields.split(","),c="",e=!1,f=0;f<d.length;f++)g=jQuery.trim(d[f]),""!=g&&(""!=c&&(c+=","),"group_configs"==g?c+="customerGroupConfig":"service_times"==g?c+="serviceTime":"is_valid"==g?c+="isValid":"user_info"==g&&(c+="userLevel",e=!0));e||(c+=",userLevel"),d="getMerchantGroupInfo.shtml",e="query","undefined"!=typeof b&&"showImDialogCallBack"==b.name&&(d="getMerchantGroupInfo",e="consult"),c=IMIP.servicePath+"/"+d+"?callback=getMerchantGroupInfoCallBack&shopId="+a.shop_id+"&entranceCode="+a.entrance_code+"&fields="+encodeURIComponent(c)+"&purpose="+e,"undefined"!=typeof a.position_code&&""!=a.position_code&&(c=c+"&positionCode="+a.position_code),IMIP.isFromH5(a.entrance_code)?(d=IMIP.getCookie2("MDD_uid"),e=IMIP.getCookie2("MDD_cvtype"),c=c+"&from=h5&userId="+d+"&userLevelDangdang="+e):(d=IMIP.getCookie(IMIP_CONF.mainDomain,"email"),e=IMIP.getCookie(IMIP_CONF.mainDomain,"viptype"),f=IMIP.getCookie(IMIP_CONF.mainDomain,"customerid"),c=c+"&from=pc&custIdCrypt="+encodeURIComponent(f)+"&emailCrypt="+encodeURIComponent(d)+"&vipTypeCrypt="+encodeURIComponent(e)),IMIP.createScript(c)}function checkLoginForH5CallBack(a){var d,b=IMIP.currentEntranceCode,c=IMIP.currentGroupId;IMIP.currentGroupId="",d=location.href,a?(NTKF_PARAM.uid=IMIP.getCookie2("MDD_email",!0),NTKF_PARAM.uname=NTKF_PARAM.uid,"undefined"!=typeof NTKF&&null!=NTKF||IMIP.isXnJsLoaded?NTKF.im_openInPageChat(c):(jQuery.ajax({url:IMIP.xnJsPath,dataType:"script",cache:!0,success:function(){NTKF.im_openInPageChat()}}),IMIP.isXnJsLoaded=!0)):(a=encodeURIComponent("["+JSON.stringify(NTKF_PARAM)+',"'+d+'","'+b+'"]'),IMIP.setCookie(IMIP_CONF.h5LoadCookieKey,a,"300"),location.href=IMIP.h5LoginPageUrl+"?burl="+encodeURIComponent(d))}function getBtnValidity(a){return 0==a&&(a=IMIP.getCookie2(IMIP_CONF.btnValidAndUserLevelCookieKey),null!=a&&""!=a&&(vArray=a.split("%"),2==vArray.length))?vArray[0]:void 0}function setBtnValidity(a,b,c){0==a&&(a=getUserLevel(a),IMIP.setCookie(IMIP_CONF.btnValidAndUserLevelCookieKey,b+"%"+a,c))}function getUserLevel(a){return 0==a&&(a=IMIP.getCookie2(IMIP_CONF.btnValidAndUserLevelCookieKey),null!=a&&""!=a&&(vArray=a.split("%"),2==vArray.length))?vArray[1]:void 0}function setUserLevel(a,b,c){0==a&&(a=getBtnValidity(a)+"%"+b,IMIP.setCookie(IMIP_CONF.btnValidAndUserLevelCookieKey,a,c))}!window.jQuery&&document.write("<script src='http://static.dangdang.com/imip/jquery.min.1.4.2.js'></script>");var IMIP_CONF={mainDomain:"dangdang.com",servicePath:"http://imip.dangdang.com",xnJsPath:"http://static.dangdang.com/ntalker/js/ntkfstat.js?siteid=dd_1000",imagePathTemplate:"http://img3x{0}.ddimg.cn/{1}/{2}/{3}-{4}_{5}.jpg",pcProductUrlTemplate:"http://product.dangdang.com/{0}.html",h5ProductUrlTemplate:"http://m.dangdang.com/h5product/product.php?pid={0}",h5LoginPageUrl:"http://h5login.dangdang.com/login.php",btnValidAndUserLevelCookieKey:"imip",xnDefaultSettiongId:"dd_1000_9999",h5LoadCookieKey:"imip_MDD_page_load_data",isLoadInAdvance:{pc_product_detail:!1,pc_shop_frontpage:!0,pc_shop_topic:!0,pc_shop_list:!0,pc_shop_collection:!0,pc_cart_home:!1,pc_checkout_home:!0,pc_order_myorder:!0,pc_order_return_apply:!0,h5_product_detail:!1,h5_shop_frontpage:!0,h5_order_detail:!0,pc_help_center:!0,h5_member_mydangdang:!0,pc_order_return_record:!0,pc_order_submit_success:!0,pc_payment_home:!0},setSellerId:{pc_product_detail:!0,pc_shop_frontpage:!0,pc_shop_topic:!0,pc_shop_list:!1,pc_shop_collection:!1,pc_cart_home:!1,pc_checkout_home:!1,pc_order_myorder:!1,pc_order_return_apply:!1,h5_product_detail:!1,h5_shop_frontpage:!0,h5_order_detail:!1,pc_help_center:!1,h5_member_mydangdang:!1,pc_order_return_record:!1,pc_order_submit_success:!1,pc_payment_home:!1},isH5Entrance:{pc_product_detail:!1,pc_shop_frontpage:!1,pc_shop_topic:!1,pc_shop_list:!1,pc_shop_collection:!1,pc_cart_home:!1,pc_checkout_home:!1,pc_order_myorder:!1,pc_order_return_apply:!1,h5_product_detail:!0,h5_shop_frontpage:!0,h5_order_detail:!0,pc_help_center:!1,h5_member_mydangdang:!0,pc_order_return_record:!1,pc_order_submit_success:!1,pc_payment_home:!1}},NTKF_PARAM={siteid:"dd_1000",settingid:IMIP_CONF.xnDefaultSettiongId},IMIP={servicePath:IMIP_CONF.servicePath,xnJsPath:IMIP_CONF.xnJsPath,imagePathTemplate:IMIP_CONF.imagePathTemplate,pcProductUrlTemplate:IMIP_CONF.pcProductUrlTemplate,h5ProductUrlTemplate:IMIP_CONF.h5ProductUrlTemplate,h5LoginPageUrl:IMIP_CONF.h5LoginPageUrl,isXnJsLoaded:!1,currentSellerId:"",currentGroupId:"",currentUserlevel:"",currentMerchantGroupInfo:{},currentEntranceCode:"",callBackFuncs:{},callBackPrameters:{},innerCallBackFuncs:{},innerCallBackPrameters:{},supplierSysParam:{},supplierImParam:{},action:"",isFromH5:function(a){return IMIP_CONF.isH5Entrance[a]?!0:!1},createScript:function(a){jQuery.ajax({url:a,dataType:"script",cache:!0,scriptCharset:"utf-8"})},showImDialogForPc:function(){var a=IMIP.currentGroupId;IMIP.currentGroupId="",NTKF_PARAM.uid=IMIP.getCookie("ddoy","email",!0),NTKF_PARAM.uname=NTKF_PARAM.uid,"undefined"==typeof IMIP.action||""==IMIP.action||"consult"==IMIP.action?"undefined"!=typeof NTKF&&null!=NTKF||IMIP.isXnJsLoaded?"undefined"!=typeof NTKF_PARAM.ntalkerparam&&"undefined"!=typeof NTKF_PARAM.ntalkerparam.item&&"undefined"!=typeof NTKF_PARAM.ntalkerparam.item.id&&""!=NTKF_PARAM.ntalkerparam.item.id?NTKF.im_openInPageChat(a,NTKF_PARAM.ntalkerparam.item.id):NTKF.im_openInPageChat(a):(jQuery.ajax({url:IMIP.xnJsPath,dataType:"script",cache:!0,success:function(){NTKF.im_openInPageChat()}}),IMIP.isXnJsLoaded=!0):jQuery.ajax({url:IMIP.xnJsPath,dataType:"script",cache:!0})},showImDialogForH5:function(){IMIP.checkLoginForH5()},getCookie:function(a,b,c){if(a=IMIP.getCookie2(a),0<a.length){var d=a.indexOf(b+"=");if(-1!=d)return d=d+b.length+1,b=a.indexOf("&",d),-1==b&&(b=a.length),"undefined"!=typeof c&&c?decodeURIComponent(a.substring(d,b)):a.substring(d,b)}return""},getCookie2:function(a,b){var c,d;if(0<document.cookie.length){if(c=document.cookie.indexOf("; "+a+"="),-1!=c)return c=c+a.length+3,d=document.cookie.indexOf("; ",c),-1==d&&(d=document.cookie.length),"undefined"!=typeof b&&b?decodeURIComponent(document.cookie.substring(c,d)):document.cookie.substring(c,d);if(c=document.cookie.indexOf(a+"="),-1!=c)return c=c+a.length+1,d=document.cookie.indexOf("; ",c),-1==d&&(d=document.cookie.length),"undefined"!=typeof b&&b?decodeURIComponent(document.cookie.substring(c,d)):document.cookie.substring(c,d)}return""},setCookie:function(a,b,c){var d=new Date;d.setTime(d.getTime()+1e3*Number(c)),document.cookie=a+"="+b+";domain="+IMIP_CONF.mainDomain+";path=/;expires="+d.toGMTString()},getImageUrl:function(a){return String.prototype.format||(String.prototype.format=function(a){var c,d,b=this;if(0<arguments.length)if(1==arguments.length&&"object"==typeof a)for(c in a)void 0!=a[c]&&(d=new RegExp("({"+c+"})","g"),b=b.replace(d,a[c]));else for(c=0;c<arguments.length;c++)void 0!=arguments[c]&&(d=new RegExp("({["+c+"]})","g"),b=b.replace(d,arguments[c]));return b}),IMIP.imagePathTemplate.format(a%10,a%99,a%37,a,1,"e")},getPcProductUrl:function(a){return""==a?"":(String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})}),IMIP.pcProductUrlTemplate.format(a))},getH5ProductUrl:function(a){return""==a?"":(String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})}),IMIP.h5ProductUrlTemplate.format(a))},checkLoginForH5:function(){var a=IMIP.getCookie2("MDD_token");"undefined"!=typeof a&&""!=a&&IMIP.createScript(IMIP.servicePath+"/checkLogin?callback=checkLoginForH5CallBack&sessionId="+a+"&clientIp=")},getSellerIdByShopId:function(a){return 0==a?"dd_1000":1e3==a?"dd_100001000":"dd_"+a}};jQuery(document).ready(function(){var b,a=IMIP.getCookie2(IMIP_CONF.h5LoadCookieKey,!0);"undefined"!=typeof a&&""!=a&&(a=eval(a),IMIP.isFromH5(a[2])&&(b=IMIP.getCookie2("MDD_token"),"undefined"!=typeof b&&""!=b&&a[1]==location.href&&(NTKF_PARAM=a[0],NTKF_PARAM.uid=IMIP.getCookie2("email",!0),NTKF_PARAM.uname=IMIP.getCookie2("email",!0),"undefined"!=typeof NTKF&&null!=NTKF||IMIP.isXnJsLoaded?NTKF.im_openInPageChat(NTKF_PARAM.settingid):(jQuery.ajax({url:IMIP.xnJsPath,dataType:"script",cache:!0,success:function(){NTKF.im_openInPageChat()}}),IMIP.isXnJsLoaded=!0))),IMIP.setCookie(IMIP_CONF.h5LoadCookieKey,"","0"))});